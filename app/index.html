<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="../bower_components/normalize-css/normalize.css"/>
    <link rel="stylesheet" href="../bower_components/font-awesome/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="../bower_components/highlightjs/styles/tomorrow.css"/>
    <link rel="stylesheet" href="../bower_components/ruban/css/ruban.min.css"/>
    <link rel="stylesheet" href="../style/my-prettify.css"/>
    <link rel="stylesheet" href="../bower_components/ruban/css/ruban-print.min.css" media="print"/>

    <script src="../bower_components/google-code-prettify/bin/run_prettify.min.js"></script>

    <title>Testable code</title>

    <style>
        .thereismore {
            font-family: "Source Code Pro",sans-serif;
            font-size: 50%;
            background-color: lightyellow;
        }
    </style>
</head>
<body>

<section class="no-toc">
    <h1><i class="fa fa-code"></i><br/>I want to write testale code <br/><i class="fa fa-code"></i></h1>
</section>

<section class="toc">
    <h1>Summary</h1>
</section>

<section>
    <h1>Testability issues</h1>
</section>

<section class="no-toc">
    <h1>Can’t instantiate a class</h1>
    <ul style="margin-top: -50px">
        <li>Static initialization</li>
        <pre class="prettyprint">
            static {
                ...
            }
            public Constructor() {
            ...
            }
        </pre>
        <li>Rely on collaborators that need to be initialized</li>
        <pre class="prettyprint">
            @BeforeClass
            public static void initEnvironement() {
                new BonitaRestAPIServlet();
                I18n.getInstance();
            }
            @Test
            public void testUsingAnAPI() {
                APIComment apiComment = new APIComment();
                ...
            }
        </pre>
        <li>Too much collaborators</li>
    </ul>
</section>

<section class="no-toc">
    <h1>Can’t invoke a method</h1>
    <ul>
        <li>Private visibility</li>
        <li>Opacity <small>can’t figure out what the method expects to receive as its arguments (java.util.Map ?)</small></li>
    </ul>
</section>

<section class="no-toc">
    <h1 style="margin-bottom: 0px;"><small>Can’t observe the outcome</small></h1>
    <small>Find yourself incapable of intercepting the interaction you’re interested in</small>
    <ul>
        <li>Hard-wired collaborators</li>
        <li>Multithreading / events</li>
    </ul>
    <ul>
        <li>Ties closely to trouble to substitute parts of the implementation</li>
    </ul>
</section>

<section class="no-toc">
    <h1><small>Can’t substitute a collaborator</small></h1>
    <ul>
        <li>Hardcoded new Collaborator()</li>
        <li>Method chain: <small>getCollaborator().doStuff().askForStuff().doMoreStuff()</small></li>
    </ul>
</section>

<section class="no-toc">
    <h1>Can’t override a method</h1>
    <ul>
        <li>With<pre class="prettyprint">private static final Collaborator getCollaborator() { ... }</pre></li>
        <li>You're unable to do that
            <pre class="prettyprint">
    @Test
    public void test() {
        final Collaborator collaborator = new TestDouble();
        ObjectUnderTest o = new ObjectUnderTest() {
            @Override
            private static final getCollaborator() {
                return collaborator;
            }
        };
        ...
    }
        </pre></li>
    </ul>
</section>

<section>
    <h1>Testable design</h1>
</section>

<section class="no-toc">
    <h1 style="margin-bottom: 0px;"><small style="font-size: 75%">Avoid complex private methods</small></h1>
    <ul>
        <li>Trivial utilities and shorthands to make your public methods read well.</li>
        <li>Tested only through those public methods.</li>
    </ul>
    <ul>
        <li>Want to test it ? Move them to another object responsible for that logic</li>
    </ul>
</section>

<section class="no-toc">
    <h1>Avoid final methods</h1>
    <ul>
        <li>Can't be overridden by test double</li>
    </ul>
    <div class="thereismore">
        <strong>What about the performance of final?</strong><br/>
        “I wouldn’t go out of my way to declare a method or class final purely for performance
        reasons. Only after you’ve definitely identified a performance problem is this even
        worth considering.”
    </div>
</section>

<section class="no-toc">
    <h1 style="margin-bottom: 0">Avoid static methods</h1>
    <ul>
        <li>Most static methods shouldn’t be.
            <ul>
                <li style="font-size: 70%">We couldn’t bother figuring out where it belongs -> Utility class</li>
            </ul>
        </li>
        <li>Hard to stub in a test.</li>
    </ul>
    <ul>
        <li><strong>Rule of thumb</strong>: do not make a method static if you foresee that you might want to stub it out in a unit test one day.</li>
    </ul>
</section>

<section class="no-toc">
    <h1>Use new with care</h1>
    <ul>
        <li><code>new</code> keyword is the most common form of hardcoding</li>
        <li>True collaborator should be passed into the constructor/method</li>
    </ul>
    <ul>
        <li><strong>Rule of thumb</strong>: do not “new up” an object if you foresee that you might want to stub it out in a unit test one day.</li>
    </ul>
</section>

<section class="no-toc">
    <h1><small>Avoid logic in constructors</small></h1>
    <ul>
        <li>Constructors are hard to bypass</li>
        <li>Triggered by subclass</li>
    </ul>
    <ul>
        <li><strong>Rule of thumb</strong>: whatever code you find in your constructors, make sure
            that it’s not something you’ll want to substitute in a unit test</li>
    </ul>
</section>

<section class="no-toc">
    <h1>Avoid the Singleton</h1>
</section>

<section class="no-toc">
    <h1>Favor composition over inheritance</h1>
</section>

<section class="no-toc">
    <h1>Wrap external libraries</h1>
</section>

<section class="no-toc">
    <h1>Avoid service lookups</h1>
</section>

<script src="../bower_components/jquery/jquery.min.js"></script>
<script src="../bower_components/keymaster/keymaster.js"></script>
<script src="../bower_components/hammerjs/hammer.min.js"></script>
<script src="../bower_components/highlightjs/highlight.pack.js"></script>
<script src="../bower_components/ruban/js/ruban.min.js"></script>
<script>
    new Ruban({
        pagination: true
    });
</script>
</body>
</html>